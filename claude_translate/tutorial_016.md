<!-- claude_translate/tutorial_016.md -->

# 16. 付録

## 16.1. インタラクティブモード

### 16.1.1. エラー処理

エラーが発生すると、インタープリタは**エラーメッセージとスタックトレース**を表示します。

**インタラクティブモードでは：**
- その後、プライマリプロンプトに戻ります

**ファイルから入力した場合：**
- スタックトレースを表示した後、非ゼロの終了ステータスで終了します

**注意点：**
- `try`文の`except`句で処理された例外は、この文脈ではエラーではありません
- 一部のエラーは無条件に致命的で、非ゼロで終了します
  - 内部の不整合
  - メモリ不足の一部のケース
- すべてのエラーメッセージは**標準エラーストリーム**に書き込まれます
- 実行されたコマンドからの通常の出力は**標準出力**に書き込まれます

### 割り込み文字

プライマリまたはセカンダリプロンプトに**割り込み文字**（通常はControl-CまたはDelete）を入力すると：
- 入力がキャンセルされます
- プライマリプロンプトに戻ります

コマンド実行中に割り込みを入力すると：
- `KeyboardInterrupt`例外が発生します
- これは`try`文で処理できます

---

## 16.1.2. 実行可能なPythonスクリプト

### Unix系システムでの実行可能スクリプト

BSD系Unixシステムでは、Pythonスクリプトをシェルスクリプトのように**直接実行可能**にできます。

**方法：**

1. **スクリプトの先頭に以下の行を追加：**
```python
#!/usr/bin/env python3.5
```
（インタープリタがユーザーの`PATH`にあると仮定）

2. **ファイルに実行可能モードを与える**

**重要なポイント：**
- `#!`はファイルの**最初の2文字**でなければなりません
- 一部のプラットフォームでは、この最初の行はUnix形式の改行（`\n`）で終わる必要があります
  - Windows形式（`\r\n`）ではダメ
- ハッシュ文字`#`は、Pythonでコメントを開始するために使用されます

### 実行可能モードの設定

`chmod`コマンドを使用してスクリプトに実行可能モード（または権限）を与えることができます：

```bash
$ chmod +x myscript.py
```

### Windowsシステムでの実行

Windowsシステムには「実行可能モード」の概念がありません。

**Windowsでの動作：**
- Pythonインストーラーは自動的に`.py`ファイルを`python.exe`に関連付けます
- Pythonファイルをダブルクリックすると、スクリプトとして実行されます
- 拡張子は`.pyw`にすることもできます
  - この場合、通常表示されるコンソールウィンドウが抑制されます

---

## 16.1.3. インタラクティブスタートアップファイル

Pythonをインタラクティブに使用する場合、インタープリタが起動されるたびに**いくつかの標準コマンドを実行**できると便利なことがよくあります。

### PYTHONSTARTUPの設定

これは、`PYTHONSTARTUP`という名前の環境変数を、スタートアップコマンドを含むファイルの名前に設定することで実現できます。

これはUnixシェルの`.profile`機能に似ています。

### スタートアップファイルの動作

**このファイルが読み込まれるタイミング：**
- インタラクティブセッションでのみ読み込まれます

**読み込まれないタイミング：**
- Pythonがスクリプトからコマンドを読み取るとき
- `/dev/tty`がコマンドの明示的なソースとして指定されているとき
  - それ以外の場合はインタラクティブセッションのように動作します

**実行される場所：**
- インタラクティブコマンドが実行されるのと同じ名前空間で実行されます
- 定義またはインポートするオブジェクトを、インタラクティブセッションで修飾なしで使用できます
- このファイル内でプロンプト`sys.ps1`と`sys.ps2`を変更することもできます

### カレントディレクトリから追加のスタートアップファイルを読み込む

カレントディレクトリから追加のスタートアップファイルを読み込みたい場合、グローバルスタートアップファイルで次のようなコードを使ってプログラムできます：

```python
if os.path.isfile('.pythonrc.py'):
    exec(open('.pythonrc.py').read())
```

### スクリプト内でスタートアップファイルを使用

スクリプト内でスタートアップファイルを使用したい場合は、スクリプト内で**明示的に**これを行う必要があります：

```python
import os
filename = os.environ.get('PYTHONSTARTUP')
if filename and os.path.isfile(filename):
    with open(filename) as fobj:
        startup_file = fobj.read()
    exec(startup_file)
```

---

## 16.1.4. カスタマイズモジュール

Pythonは、カスタマイズするための**2つのフック**を提供しています：
- `sitecustomize`
- `usercustomize`

### usercustomizeの使い方

**ステップ1：ユーザーsite-packagesディレクトリの場所を見つける**

Pythonを起動して、このコードを実行します：

```python
>>> import site
>>> site.getusersitepackages()
'/home/user/.local/lib/python3.5/site-packages'
```

**ステップ2：usercustomize.pyファイルを作成**

そのディレクトリに`usercustomize.py`という名前のファイルを作成し、その中に何でも好きなものを入れることができます。

**影響範囲：**
- Pythonのすべての呼び出しに影響します
- ただし、`-s`オプションで起動して自動インポートを無効にした場合を除きます

### sitecustomizeとの違い

`sitecustomize`も同じように機能しますが：
- 通常、コンピュータの管理者によって作成されます
- グローバルなsite-packagesディレクトリに配置されます
- `usercustomize`の**前に**インポートされます

詳細については、`site`モジュールのドキュメントを参照してください。

---

## 📝 重要ポイントまとめ

### 1. エラー処理
- エラー発生時：エラーメッセージ + スタックトレース表示
- インタラクティブモード：プロンプトに戻る
- ファイルから実行：非ゼロステータスで終了
- Control-C：`KeyboardInterrupt`例外を発生

### 2. 実行可能スクリプト

| システム   | 方法                                  | 詳細                                          |
| ---------- | ------------------------------------- | --------------------------------------------- |
| Unix/Linux | `#!/usr/bin/env python3` + `chmod +x` | シバン行を追加して実行権限を付与              |
| Windows    | `.py`または`.pyw`拡張子               | 自動的に関連付けられる（.pwはコンソールなし） |

### 3. スタートアップファイル
- **環境変数**: `PYTHONSTARTUP`
- **用途**: インタラクティブセッション開始時に自動実行
- **場所**: ユーザーが指定した任意のパス
- **スクリプトでは使えない**: 明示的に読み込む必要あり

### 4. カスタマイズモジュール

| モジュール      | 場所                    | 作成者   | インポート順 |
| --------------- | ----------------------- | -------- | ------------ |
| `sitecustomize` | グローバルsite-packages | 管理者   | 先           |
| `usercustomize` | ユーザーsite-packages   | ユーザー | 後           |

### 試験対策で覚えておくこと
1. **実行可能スクリプト**: Unix系では`#!/usr/bin/env python3`が必要
2. **PYTHONSTARTUP**: インタラクティブセッションの起動時に実行されるファイル
3. **KeyboardInterrupt**: Control-Cで発生する例外
4. **エラー出力**: 標準エラーストリームに出力される
5. **usercustomize**: ユーザーごとのPythonカスタマイズ

### よく使うシーン
- **開発時**: PYTHONSTARTUPでよく使うimportを自動化
- **スクリプト配布**: Unixで実行可能にして`./script.py`で実行
- **環境設定**: usercustomizeでデフォルト設定をカスタマイズ

これで付録も完璧だね！チュートリアル全部終わったんじゃない？٩(°̀ᗝ°́)و